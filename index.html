<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>Chess Platform</title>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <link rel="stylesheet" href="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.css">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>

    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #2c3e50; color: white; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .container { background: white; padding: 2rem; border-radius: 15px; color: #333; width: 350px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        
        /* Dashboard con immagine scacchi */
        #dashboard { display: none; text-align: center; background: white; padding: 20px; border-radius: 15px; color: #333; }
        .game-card { cursor: pointer; transition: transform 0.2s; border: 2px solid #ddd; padding: 10px; border-radius: 10px; }
        .game-card:hover { transform: scale(1.05); border-color: #2ecc71; }
        .game-card img { width: 200px; border-radius: 8px; }

        /* Area Gioco */
        #game-container { display: none; flex-direction: column; align-items: center; width: 400px; }
        #myBoard { width: 100%; margin-top: 10px; }
        .info { margin-bottom: 10px; font-weight: bold; }
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div id="auth-screen" class="container">
        <h2>Accedi alla Piattaforma</h2>
        <div id="g_id_onload"
             data-client_id="889726241272-aft2l0vrfb3bjcquciqsgsm08454pb9j.apps.googleusercontent.com"
             data-callback="handleCredentialResponse">
        </div>
        <div class="g_id_signin" data-type="standard"></div>
        <div style="margin: 15px 0;">oppure</div>
        <input type="text" id="nickname" placeholder="Nickname" style="width:80%; padding:10px; margin-bottom:10px;">
        <button onclick="showDashboard('Guest')" style="padding:10px 20px; background:#27ae60; color:white; border:none; border-radius:5px; cursor:pointer;">Entra</button>
    </div>

    <div id="dashboard">
        <h2 id="welcome-msg">Benvenuto!</h2>
        <p>Scegli un gioco:</p>
        <div class="game-card" onclick="startChess()">
            <img src="https://images.unsplash.com/photo-1524712245354-2c4e5e7124c5?auto=format&fit=crop&w=300" alt="Scacchi">
            <h3>Scacchi contro Bot</h3>
        </div>
    </div>

    <div id="game-container">
        <div class="info">Giocatore: <span id="player-name"></span></div>
        <div id="myBoard"></div>
        <p>Muovi le pedine bianche per iniziare!</p>
        <button onclick="location.reload()" style="margin-top:10px;">Torna alla Home</button>
    </div>

<script>
    let nickname = "";
    let board = null;
    let game = new Chess();

    // Gestione Login Google
    function handleCredentialResponse(response) {
        const payload = JSON.parse(atob(response.credential.split('.')[1]));
        showDashboard(payload.name);
    }

    function showDashboard(name) {
        nickname = name;
        document.getElementById('auth-screen').classList.add('hidden');
        document.getElementById('dashboard').style.display = 'block';
        document.getElementById('welcome-msg').innerText = "Ciao, " + nickname + "!";
    }

    // Inizio Gioco Scacchi
    function startChess() {
        document.getElementById('dashboard').style.display = 'none';
        document.getElementById('game-container').style.display = 'flex';
        document.getElementById('player-name').innerText = nickname;

        const config = {
            draggable: true,
            position: 'start',
            onDrop: onDrop
        };
        board = Chessboard('myBoard', config);
    }

    // Logica mosse e Bot semplice (mossa casuale)
    function onDrop(source, target) {
        let move = game.move({
            from: source,
            to: target,
            promotion: 'q' // promuovi sempre a regina per semplicit√†
        });

        if (move === null) return 'snapback';

        // Mossa del Bot dopo 250ms
        window.setTimeout(makeRandomMove, 250);
    }

    function makeRandomMove() {
        let possibleMoves = game.moves();
        if (possibleMoves.length === 0) {
            alert("Partita finita!");
            return;
        }

        let randomIndex = Math.floor(Math.random() * possibleMoves.length);
        game.move(possibleMoves[randomIndex]);
        board.position(game.fen());
    }
</script>
</body>
</html>