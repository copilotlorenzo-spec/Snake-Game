<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>Login & Snake Game</title>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #1a1a1a; color: white; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; overflow: hidden; }
        .container { background: white; padding: 2rem; border-radius: 15px; color: #333; width: 350px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; }
        #login-btn { width: 100%; padding: 12px; background: #28a745; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; }
        
        /* Area Gioco */
        #game-container { display: none; flex-direction: column; align-items: center; }
        canvas { border: 5px solid #333; background: #000; box-shadow: 0 0 20px rgba(0,255,0,0.2); }
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div id="auth-screen" class="container">
        <h2>Benvenuto</h2>
        <div id="g_id_onload"
             data-client_id="889726241272-aft2l0vrfb3bjcquciqsgsm08454pb9j.apps.googleusercontent.com"
             data-callback="handleCredentialResponse">
        </div>
        <div class="g_id_signin" data-type="standard"></div>

        <div style="margin: 20px 0; color: #999;">oppure</div>

        <input type="text" id="nickname" placeholder="Inserisci Nickname">
        <button id="login-btn" onclick="startGameCustom()">Gioca ora</button>
    </div>

    <div id="game-container">
        <h3 id="player-display">Giocatore: </h3>
        <canvas id="snakeGame" width="400" height="400"></canvas>
        <p>Usa le frecce per muoverti</p>
    </div>

<script>
    let canvas, ctx, nickname = "";
    let snake = [{x: 10, y: 10}];
    let food = {x: 15, y: 15};
    let dx = 0, dy = 0;
    let score = 0;

    // 1. GESTIONE LOGIN GOOGLE
    function handleCredentialResponse(response) {
        // Decodifica il nome dal token di Google (semplificato per demo)
        const payload = JSON.parse(atob(response.credential.split('.')[1]));
        nickname = payload.name;
        initGame();
    }

    // 2. GESTIONE LOGIN MANUALE
    function startGameCustom() {
        nickname = document.getElementById('nickname').value || "Guest";
        initGame();
    }

    function initGame() {
        document.getElementById('auth-screen').classList.add('hidden');
        document.getElementById('game-container').style.display = 'flex';
        document.getElementById('player-display').innerText = "Giocatore: " + nickname;
        
        canvas = document.getElementById('snakeGame');
        ctx = canvas.getContext('2d');
        document.addEventListener('keydown', changeDirection);
        setInterval(draw, 100);
    }

    // 3. LOGICA SNAKE
    function draw() {
        // Muovi testa
        const head = {x: snake[0].x + dx, y: snake[0].y + dy};
        snake.unshift(head);

        // Mangia cibo
        if (head.x === food.x && head.y === food.y) {
            food = {x: Math.floor(Math.random() * 20), y: Math.floor(Math.random() * 20)};
        } else {
            if(dx !== 0 || dy !== 0) snake.pop();
        }

        // Reset Canvas
        ctx.fillStyle = "black";
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // Disegna Cibo
        ctx.fillStyle = "red";
        ctx.fillRect(food.x * 20, food.y * 20, 18, 18);

        // Disegna Serpente
        snake.forEach((part, index) => {
            ctx.fillStyle = (index === 0) ? "#00FF00" : "#008000";
            ctx.fillRect(part.x * 20, part.y * 20, 18, 18);

            // NICKNAME SULLA TESTA
            if (index === 0) {
                ctx.fillStyle = "white";
                ctx.font = "12px Arial";
                ctx.textAlign = "center";
                ctx.fillText(nickname, part.x * 20 + 10, part.y * 20 - 5);
            }
        });

        // Collisioni Muri
        if (head.x < 0 || head.x >= 20 || head.y < 0 || head.y >= 20) resetGame();
    }

    function changeDirection(e) {
        if (e.key === "ArrowUp" && dy === 0) { dx = 0; dy = -1; }
        if (e.key === "ArrowDown" && dy === 0) { dx = 0; dy = 1; }
        if (e.key === "ArrowLeft" && dx === 0) { dx = -1; dy = 0; }
        if (e.key === "ArrowRight" && dx === 0) { dx = 1; dy = 0; }
    }

    function resetGame() {
        snake = [{x: 10, y: 10}];
        dx = 0; dy = 0;
        alert("Game Over! Riprova.");
    }
</script>
</body>
</html>